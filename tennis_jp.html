<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Teams NEO Match Pro v0.9</title>
    <style>
        :root {
            --main-green: #2c8a4b;
            --court-blue: #4e8bc4;
            --clay-orange: #e07030;
            --bg-gray: #f4f6f8;
            --error-red: #ff6b6b;
        }
        body {
            font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
            background-color: var(--bg-gray);
            margin: 0;
            padding: 0;
            color: #333;
        }
        header {
            background-color: var(--main-green);
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
            padding-bottom: 50px;
        }

        /* ã‚«ãƒ¼ãƒ‰å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        .card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 15px;
        }
        .card-header {
            font-weight: bold;
            margin-bottom: 12px;
            color: #444;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* è¨­å®šãƒ•ã‚©ãƒ¼ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
        .form-group {
            margin-bottom: 15px;
        }
        .form-label {
            display: block;
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .radio-group {
            display: flex;
            gap: 10px;
        }
        .radio-btn {
            flex: 1;
        }
        .radio-btn input {
            display: none;
        }
        .radio-btn label {
            display: block;
            text-align: center;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .radio-btn input:checked + label {
            background: #e8f5e9;
            border-color: var(--main-green);
            color: var(--main-green);
            font-weight: bold;
        }

        /* æ•°å­—ã‚’å…¥åŠ› */
        input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        input[type="number"]:focus {
            outline: none;
            border-color: var(--main-green);
        }

        /* é¸æ‰‹åã‚’å…¥åŠ› */
        textarea {
            width: 100%;
            height: 80px;
            padding: 10px;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 8px;
            resize: none;
            font-family: inherit;
            font-size: 14px;
        }

        /* ãƒ¡ã‚¤ãƒ³ãƒœã‚¿ãƒ³ */
        .btn-generate {
            width: 100%;
            padding: 15px;
            background-color: var(--main-green);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #1e5c32;
            transition: active 0.1s;
            margin-top: 10px;
        }
        .btn-generate:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* ãƒãƒƒãƒã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ« */
        .match-card {
            border-left: 5px solid var(--court-blue);
            position: relative;
        }
        .match-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
            color: var(--court-blue);
            font-weight: bold;
        }
        .match-body {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 5px;
        }
        .team-box {
            flex: 1;
            text-align: center;
            background: #f8f9fa;
            padding: 10px 5px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
        }
        .score-input {
            width: 40px;
            text-align: center;
            font-size: 18px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 0 5px;
        }
        .btn-finish {
            width: 100%;
            margin-top: 10px;
            padding: 8px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
        }

        /* å¾…æ©Ÿ & ã‚¨ãƒ©ãƒ¼ */
        .waiting-card {
            background: #fff9db;
            border-left: 5px solid #fcc419;
            color: #664d03;
        }
        .error-msg {
            color: var(--error-red);
            font-size: 13px;
            margin-top: 5px;
            display: none;
        }

        /* History */
        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            font-size: 13px;
        }
        .history-item:last-child { border-bottom: none; }
        .winner { color: var(--main-green); font-weight: bold; }
        .loser { color: #999; }
        .score-badge { background: #333; color: white; padding: 2px 6px; border-radius: 4px; margin: 0 5px; }

        .btn-reset {
            font-size: 12px;
            color: #dc3545;
            background: white;
            border: 1px solid #dc3545;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <header>ğŸ¾ Teams NEO Match Pro v0.9</header>

    <div class="container">
        
        <!-- è¨­å®šãƒ‘ãƒãƒ« -->
        <div class="card">
            <div class="card-header">âš™ï¸ ã‚²ãƒ¼ãƒ è¨­å®š</div>

            <!-- 1. ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ« (ã‚·ãƒ³ã‚°ãƒ«ã‚¹/ãƒ€ãƒ–ãƒ«ã‚¹) -->
            <div class="form-group">
                <span class="form-label">1. ã‚²ãƒ¼ãƒ æ–¹å¼</span>
                <div class="radio-group">
                    <div class="radio-btn">
                        <input type="radio" name="gameMode" id="modeDouble" value="double" checked onchange="updateValidation()">
                        <label for="modeDouble">ãƒ€ãƒ–ãƒ«ã‚¹ (2 vs 2)</label>
                    </div>
                    <div class="radio-btn">
                        <input type="radio" name="gameMode" id="modeSingle" value="single" onchange="updateValidation()">
                        <label for="modeSingle">ã‚·ãƒ³ã‚°ãƒ«ã‚¹ (1 vs 1)</label>
                    </div>
                </div>
            </div>

            <!-- 2. å‚åŠ è€…æ•° -->
            <div class="form-group">
                <span class="form-label">2. å‚åŠ è€…æ•° (3 ~ 12äºº)</span>
                <input type="number" id="playerCountInput" min="3" max="12" placeholder="æ•°å­—ã‚’å…¥åŠ›(ä¾‹: 6)" oninput="updatePlayerPlaceholder()">
                <div id="countError" class="error-msg">âš ï¸ å‚åŠ è€…æ•°ã¯3äººã‹ã‚‰12äººã¾ã§ã§ã™ã€‚</div>
            </div>

            <!-- 3. ã‚³ãƒ¼ãƒˆæ•° -->
            <div class="form-group">
                <span class="form-label">3. ã‚³ãƒ¼ãƒˆé¢æ•°</span>
                <div class="radio-group">
                    <div class="radio-btn">
                        <input type="radio" name="courtCount" id="court1" value="1" checked>
                        <label for="court1">1é¢</label>
                    </div>
                    <div class="radio-btn">
                        <input type="radio" name="courtCount" id="court2" value="2">
                        <label for="court2">2é¢</label>
                    </div>
                </div>
            </div>

            <!-- åå‰ã‚’å…¥åŠ› (ã‚ªãƒ—ã‚·ãƒ§ãƒ³) -->
            <div class="form-group">
                <span class="form-label">å‚åŠ è€…ã®åå‰ã‚’å…¥åŠ›</span>
                <textarea id="playerNames" placeholder="åå‰ã®é–“ã«ã¯ã‚³ãƒ³ãƒ(,)å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"></textarea>
                <div style="text-align:right; font-size:12px; color:#888; margin-top:4px;">
                    ç¾åœ¨ã®å…¥åŠ›: <span id="currentNameCount">0</span>äºº / ç›®æ¨™: <span id="targetNameCount">0</span>äºº
                </div>
                <div id="nameMismatchError" class="error-msg">âš ï¸ è¨­å®šã—ãŸå‚åŠ è€…æ•°ã¨å…¥åŠ›ã—ãŸåå‰ã®æ•°ãŒä¸€è‡´ã—ã¾ã›ã‚“ã€‚</div>
            </div>

            <button onclick="generateMatches()" class="btn-generate">ğŸ² å¯¾æˆ¦è¡¨ã‚’ä½œæˆ</button>
        </div>

        <!-- é€²è¡Œä¸­ã®ãƒãƒƒãƒ -->
        <div class="card-header" style="padding:0 10px; margin-bottom:10px; border:none;">ğŸ”¥ é€²è¡Œä¸­ã®ãƒãƒƒãƒ</div>
        <div id="active-matches">
            <div style="text-align:center; color:#999; padding:20px; background:white; border-radius:12px;">
                è©¦åˆã‚’å§‹ã‚ã¦ãã ã•ã„ã€‚
            </div>
        </div>

        <!-- å±¥æ­´ -->
        <div class="card" style="margin-top:20px;">
            <div class="card-header">
                <span>ğŸ“‹ è©¦åˆå±¥æ­´ (æœ€æ–°ã®20è©¦åˆ)</span>
                <button onclick="resetHistory()" class="btn-reset">ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
            <div id="history-list" class="history-list">
                <!-- è¨˜éŒ²ã‚¢ã‚¤ãƒ†ãƒ  -->
            </div>
        </div>

    </div>

    <script>
        // ì „ì—­ ìƒíƒœ ë³€ìˆ˜
        let currentMatches = [];
        let matchHistory = [];

        // ì´ˆê¸°í™” ë° ë¡œë“œ
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            updatePlayerPlaceholder();
            renderMatches();
            renderHistory();

            // ì´ë¦„ ì…ë ¥ ì‹œ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('playerNames').addEventListener('input', () => {
                updateNameCount();
                saveData(); // ì…ë ¥ ì¤‘ ìë™ ì €ì¥
            });
        });

        // 2. ì°¸ê°€ì ìˆ˜ ì…ë ¥ì— ë”°ë¥¸ UI ì—…ë°ì´íŠ¸
        function updatePlayerPlaceholder() {
            const countInput = document.getElementById('playerCountInput');
            let count = parseInt(countInput.value);
            
            // ì—ëŸ¬ ë©”ì‹œì§€ ì´ˆê¸°í™”
            document.getElementById('countError').style.display = 'none';
            
            if (isNaN(count)) count = 0;
            document.getElementById('targetNameCount').textContent = count;

            // ì´ë¦„ ì…ë ¥ë€ì— ì˜ˆì‹œ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (UX)
            updateNameCount();
        }

        // ì´ë¦„ ê°œìˆ˜ ì‹¤ì‹œê°„ ì²´í¬
        function updateNameCount() {
            const text = document.getElementById('playerNames').value;
            const names = text.split(/,|\n/).map(s => s.trim()).filter(s => s !== "");
            document.getElementById('currentNameCount').textContent = names.length;
            document.getElementById('nameMismatchError').style.display = 'none';
        }

        // ê²€ì¦ ë¡œì§ ì—…ë°ì´íŠ¸
        function updateValidation() {
            // ëª¨ë“œ ë³€ê²½ ì‹œ íŠ¹ì´ì‚¬í•­ ìˆìœ¼ë©´ ì²˜ë¦¬ (í˜„ì¬ëŠ” ì—†ìŒ)
        }

        // --- í•µì‹¬: ëŒ€ì§„í‘œ ìƒì„± ë¡œì§ ---
        function generateMatches() {
            // 1. ì„¤ì • ê°’ ê°€ì ¸ì˜¤ê¸°
            const mode = document.querySelector('input[name="gameMode"]:checked').value;
            const targetCount = parseInt(document.getElementById('playerCountInput').value);
            const courtLimit = parseInt(document.querySelector('input[name="courtCount"]:checked').value);
            const nameText = document.getElementById('playerNames').value;
            let players = nameText.split(/,|\n/).map(s => s.trim()).filter(s => s !== "");

            // 2. ê²€ì¦ (Validation)
            const countError = document.getElementById('countError');
            const nameError = document.getElementById('nameMismatchError');
            
            countError.style.display = 'none';
            nameError.style.display = 'none';

            // 2-1. ìˆ«ì ë²”ìœ„ ì²´í¬
            if (isNaN(targetCount) || targetCount < 3 || targetCount > 12) {
                countError.style.display = 'block';
                alert("ì°¸ê°€ì ìˆ˜ëŠ” 3ëª… ì´ìƒ 12ëª… ì´í•˜ë¡œ ì„¤ì •í•´ ì£¼ì„¸ìš”.");
                return;
            }

            // 2-2. ë³µì‹ ìµœì†Œ ì¸ì› ì²´í¬
            if (mode === 'double' && targetCount < 4) {
                alert("ë³µì‹ ê²Œì„ì€ ìµœì†Œ 4ëª…ì´ í•„ìš”í•©ë‹ˆë‹¤.");
                return;
            }

            // 2-3. ì…ë ¥ëœ ì´ë¦„ ê°œìˆ˜ ì²´í¬
            if (players.length !== targetCount) {
                nameError.style.display = 'block';
                alert(`è¨­å®šã—ãŸäººæ•°(${targetCount}äºº)ã¨å…¥åŠ›ã—ãŸåå‰ã®æ•°(${players.length}äºº)ãŒä¸€è‡´ã—ã¾ã›ã‚“ã€‚`);
                return;
            }

            // 3. ë¡œì§ ì‹¤í–‰
            // ì…”í”Œ
            for (let i = players.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [players[i], players[j]] = [players[j], players[i]];
            }

            currentMatches = []; // ì´ˆê¸°í™”
            let playersCopy = [...players]; // ëŒ€ê¸°ì ì²˜ë¦¬ë¥¼ ìœ„í•´ ë³µì‚¬ë³¸ ì‚¬ìš©

            // ì½”íŠ¸ ë°°ì •
            for (let c = 1; c <= courtLimit; c++) {
                // í•„ìš”í•œ ì¸ì›: ë³µì‹(4), ë‹¨ì‹(2)
                const needed = (mode === 'double') ? 4 : 2;

                if (playersCopy.length >= needed) {
                    const teamA = [];
                    const teamB = [];
                    
                    if (mode === 'double') {
                        teamA.push(playersCopy.shift(), playersCopy.shift());
                        teamB.push(playersCopy.shift(), playersCopy.shift());
                    } else {
                        teamA.push(playersCopy.shift());
                        teamB.push(playersCopy.shift());
                    }

                    currentMatches.push({
                        id: Date.now() + Math.random(),
                        court: c,
                        mode: mode,
                        teamA: teamA,
                        teamB: teamB,
                        scoreA: '',
                        scoreB: ''
                    });
                } else {
                    // ì½”íŠ¸ëŠ” 2ê°œë¥¼ ì›í–ˆì§€ë§Œ ì¸ì›ì´ ë¶€ì¡±í•œ ê²½ìš° -> ë£¨í”„ ì¢…ë£Œí•˜ê±°ë‚˜ ë¹ˆ ì½”íŠ¸ ë©”ì‹œì§€ ì²˜ë¦¬ëŠ” ë Œë”ë§ì—ì„œ
                }
            }

            // ë‚¨ì€ ì¸ì›ì€ ëŒ€ê¸°ì
            if (playersCopy.length > 0) {
                currentMatches.push({
                    isWaiting: true,
                    players: playersCopy
                });
            }

            saveData();
            renderMatches();
        }

        // ë Œë”ë§: ì§„í–‰ ì¤‘ì¸ ë§¤ì¹˜
        function renderMatches() {
            const container = document.getElementById('active-matches');
            container.innerHTML = "";

            if (currentMatches.length === 0) {
                container.innerHTML = '<div style="text-align:center; color:#999; padding:20px; background:white; border-radius:12px;">è¨­å®šã®å¾Œã€å¯¾æˆ¦è¡¨ã®ç”Ÿæˆãƒœã‚¿ãƒ³æŠ¼ã—ã¦ãã ã•ã„ã€‚</div>';
                return;
            }

            currentMatches.forEach((match, index) => {
                if (match.isWaiting) {
                    container.innerHTML += `
                        <div class="card waiting-card" style="padding:15px;">
                            <div style="font-weight:bold; margin-bottom:5px;">â˜• å¾…æ©Ÿ / ä¼‘ã¿ (${match.players.length}äºº)</div>
                            <div>${match.players.join(', ')}</div>
                        </div>
                    `;
                } else {
                    // ë‹¨ì‹/ë³µì‹ì— ë”°ë¼ í‘œì‹œ ë°©ì‹ ì¡°ì •
                    const teamAText = match.teamA.join('<br>');
                    const teamBText = match.teamB.join('<br>');
                    const modeLabel = match.mode === 'double' ? 'ãƒ€ãƒ–ãƒ«ã‚¹' : 'ã‚·ãƒ³ã‚°ãƒ«ã‚¹';

                    container.innerHTML += `
                        <div class="card match-card" style="padding:15px;">
                            <div class="match-header">
                                <span>ã‚³ãƒ¼ãƒˆ ${match.court} (${modeLabel})</span>
                                <span>é€²è¡Œä¸­</span>
                            </div>
                            <div class="match-body">
                                <div class="team-box">
                                    ${teamAText}
                                </div>
                                <input type="tel" class="score-input" value="${match.scoreA}" placeholder="0" onchange="updateScore(${index}, 'A', this.value)">
                                <span style="color:#999; font-weight:bold;">:</span>
                                <input type="tel" class="score-input" value="${match.scoreB}" placeholder="0" onchange="updateScore(${index}, 'B', this.value)">
                                <div class="team-box">
                                    ${teamBText}
                                </div>
                            </div>
                            <button class="btn-finish" onclick="finishMatch(${index})">è©¦åˆçµ‚äº†ã¨è¨˜éŒ²</button>
                        </div>
                    `;
                }
            });
        }

        // ì ìˆ˜ ì €ì¥
        function updateScore(index, team, value) {
            if (team === 'A') currentMatches[index].scoreA = value;
            else currentMatches[index].scoreB = value;
            saveData();
        }

        // ê²½ê¸° ì¢…ë£Œ
        function finishMatch(index) {
            const match = currentMatches[index];
            if (!match.scoreA || !match.scoreB) {
                if(!confirm("ç‚¹æ•°ã‚’è¨˜å…¥ã›ãšçµ‚äº†ã—ã¾ã™ã‹?")) return;
            }

            // íˆìŠ¤í† ë¦¬ ì¶”ê°€ (ìµœëŒ€ 20ê°œ ìœ ì§€)
            const historyItem = {
                time: new Date().toLocaleTimeString('ko-KR', {hour:'2-digit', minute:'2-digit'}),
                ...match
            };
            
            matchHistory.unshift(historyItem);
            if (matchHistory.length > 20) {
                matchHistory = matchHistory.slice(0, 20); // 20ê°œê¹Œì§€ë§Œ ìë¥´ê¸°
            }

            // ì§„í–‰ ì¤‘ ëª©ë¡ì—ì„œ ì‚­ì œ
            currentMatches.splice(index, 1);
            
            saveData();
            renderMatches();
            renderHistory();
        }

        // ë Œë”ë§: íˆìŠ¤í† ë¦¬
        function renderHistory() {
            const container = document.getElementById('history-list');
            container.innerHTML = "";

            if (matchHistory.length === 0) {
                container.innerHTML = '<div style="padding:15px; text-align:center; color:#ccc;">è©¦åˆå±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>';
                return;
            }

            matchHistory.forEach(match => {
                const sA = parseInt(match.scoreA) || 0;
                const sB = parseInt(match.scoreB) || 0;
                const teamAClass = sA > sB ? 'winner' : (sA < sB ? 'loser' : '');
                const teamBClass = sB > sA ? 'winner' : (sB < sA ? 'loser' : '');
                
                const teamAStr = match.teamA.join(', ');
                const teamBStr = match.teamB.join(', ');

                container.innerHTML += `
                    <div class="history-item">
                        <div style="flex:1; text-align:right;" class="${teamAClass}">${teamAStr}</div>
                        <span class="score-badge">${match.scoreA} : ${match.scoreB}</span>
                        <div style="flex:1; text-align:left;" class="${teamBClass}">${teamBStr}</div>
                    </div>
                `;
            });
        }

        // íˆìŠ¤í† ë¦¬ ë¦¬ì…‹
        function resetHistory() {
            if(confirm("ã™ã¹ã¦ã®å±¥æ­´ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹?")) {
                matchHistory = [];
                saveData();
                renderHistory();
            }
        }

        // ë°ì´í„° ì €ì¥
        function saveData() {
            localStorage.setItem('tp_mode', document.querySelector('input[name="gameMode"]:checked').value);
            localStorage.setItem('tp_count', document.getElementById('playerCountInput').value);
            localStorage.setItem('tp_court', document.querySelector('input[name="courtCount"]:checked').value);
            localStorage.setItem('tp_names', document.getElementById('playerNames').value);
            localStorage.setItem('tp_matches', JSON.stringify(currentMatches));
            localStorage.setItem('tp_history', JSON.stringify(matchHistory));
        }

        // ë°ì´í„° ë¡œë“œ
        function loadData() {
            const mode = localStorage.getItem('tp_mode');
            if(mode) document.querySelector(`input[name="gameMode"][value="${mode}"]`).checked = true;

            const count = localStorage.getItem('tp_count');
            if(count) document.getElementById('playerCountInput').value = count;

            const court = localStorage.getItem('tp_court');
            if(court) document.querySelector(`input[name="courtCount"][value="${court}"]`).checked = true;

            const names = localStorage.getItem('tp_names');
            if(names) document.getElementById('playerNames').value = names;

            const matches = localStorage.getItem('tp_matches');
            if(matches) currentMatches = JSON.parse(matches);

            const history = localStorage.getItem('tp_history');
            if(history) matchHistory = JSON.parse(history);
        }
    </script>
</body>
</html>